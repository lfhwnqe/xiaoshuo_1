# 项目总览（xiaoshuo_1）

> 基于提示工程与多智能体（Multi‑Agent）的长篇小说自动创作系统，采用 Mastra（TypeScript）工作流（Workflow）建模，实现从“设定初始化”到“逐章创作”的端到端流水线，强调连贯性、一致性与可回溯性。

## 目标与范围

- 长篇小说自动化生产线：覆盖“设定/世界观/角色/风格 → 全局大纲 → 逐章策划 → 正文创作 → 连贯性校验 → 记忆更新”。
- 多智能体协作：按照 README 的两套主流程拆分专职 Agent 职责，编排为 Mastra 的步骤（Step）与工作流（Workflow）。
- 可插拔的记忆与检索：保留“章节摘要库 + 长程记忆库（向量检索/知识库）”接口，便于后续替换具体实现。
- 人在环（Human‑in‑the‑loop）：关键节点（大纲定稿、章节梗概、最终稿）支持人工审阅与回退/重试。
- 生产级工程实践：目录规范、配置分层、日志/追踪、错误处理、幂等和可观测性设计。

## 关键决策

- 技术栈：TypeScript + Mastra Workflows（vNext API：`createWorkflow/createStep` 为主，保留 Legacy 兼容思路）。
- 状态与存储：
  - 最小可行：本地 JSON/SQLite 记录元数据与状态；向量检索可以先用本地嵌入（可选）或占位实现。
  - 可扩展：抽象 MemoryProvider 接口，后续可换 Pinecone/Weaviate/pgvector。
- 部署形态：
  - 开发期：Node 本地运行/命令行触发；
  - 运行期：可接入 Serverless（如 Vercel/Hono）+ 定时/事件触发。

## 总体蓝图

- 顶层两个主工作流：
  1) 小说初始化工作流（InitializationWorkflow）
  2) 章节写作工作流（ChapterWorkflow）
- 子工作流与步骤复用：章节工作流内包含“上下文提取/章节策划/正文生成/一致性校验与记忆更新”等子工作流；通用“风格检查”“一致性检查”作为可复用 Step。
- 控制流：根据 Mastra 能力使用 `.then()` 串行、`.branch()` 条件分支、`.parallel()` 并行、`.while()`/`.until()` 循环重试与“修订回路”。

## 交付物

- 架构说明、工作流设计、数据与状态、提示工程与风格指南固化、开发与运行手册、里程碑规划、运维与回滚策略（见本目录其他文档）。

